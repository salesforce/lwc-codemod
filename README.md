# lwc-codemod

Codemods for [LWC](https://lwc.dev/). In other words: scripts to transform LWC component code.

Currently it can convert components from shadow DOM to [light DOM](https://lwc.dev/guide/light_dom#light-dom-(developer-preview)) and from synthetic shadow DOM to [native shadow DOM](https://rfcs.lwc.dev/rfcs/lwc/0115-mixed-shadow-mode).

## Installation

```sh
npm i -g lwc-codemod
```

Or, to avoid installing globally, use `npx lwc-codemod`.

## Basic usage

```sh
lwc-codemod <transform> <path>
```

When you pass in a `<path>`, the script will crawl all components inside of that path:

```sh
lwc-codemod <transform> /path/to/my/components/
```

## Transforms

Available transforms:

- [Shadow DOM to Light DOM](#shadow-dom-to-light-dom) (`shadow-to-light`)
- [Synthetic Shadow DOM to Native Shadow DOM](#synthetic-shadow-dom-to-native-shadow-dom) (`synthetic-to-native`)
- [HTML Template Cleanup](#html-template-cleanup) (`html-template-cleanup`)

### Shadow DOM to Light DOM

#### Usage

```sh
lwc-codemod shadow-to-light <directory>
```

#### Summary

Converts components from shadow DOM to light DOM.

#### JS

- Adds `static renderMode = 'light'`
- `this.template` -> `this` (and destructuring equivalents)

#### HTML

- Adds `lwc:render-mode="light"`
- Removes `lwc:dom="manual"`

#### CSS

- Moves `foo.css` to `foo.scoped.css`

#### `lwc:dom="manual"`

For this case, the styles still need to be scoped to the `lwc:dom="manual"` tree. So the codemod creates an additional global CSS file containing selectors to replace e.g. `div` with `.auto-generated div`, where `auto-generated` is a class applied to `lwc:dom="manual"` nodes.

#### Slots

For slots, a wrapper `<div>` is created around the `<slot>`so that this `<div>` can be targeted in the CSS and have events attached to it, e.g. `onscroll` events.

`onslotchange` is currently not implemented. As an alternative, you can use [`MutationObserver`](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver) or explicit signalling between components to notify of changes. 

### Synthetic Shadow DOM to Native Shadow DOM

#### Usage

```sh
lwc-codemod synthetic-to-native <path>
```

#### Summary

Converts components from synthetic shadow to native shadow.

The only transformation it currently applies is to add the `static shadowSupportMode` property. Any other discrepancies between native shadow and synthetic shadow will have to be handled manually.

### HTML Template Cleanup

#### Usage

```sh
lwc-codemod html-template-cleanup <path>
```

#### Summary

Fixes several HTML warnings/errors generated by the `@lwc/template-compiler`

##### Multiple `if:true`/`if:false` Directives on the Same Element

Removes excessive `if:true` and `if:false` attributes that appear on the same element. 

Only the first `if:true`/`if:false` is processed in LWC, this mod will remove all other instances.

For example:

```html
<template>
    <div if:true={visible} if:false={visible}></div>
</template>
```

Will become

```html
<template>
    <div if:true={visible}></div>
</template>
```

##### Invalid Template Attributes

Removes invalid attributes from both root and non-root `templates`.

These attributes are ignored by LWC during parsing, and are thus safe to remove.

For example:

```html
<template class="slds-style">
    <span>hello world!</span>
</template>
```

Will become:

```html
<template>
    <span>hello world!</span>
</template>
```

See the official [documentation](https://developer.salesforce.com/docs/component-library/documentation/en/lwc/lwc.reference_directives) for valid `template` attributes.

Note that for non-root `template` elements, if there aren't any valid directives, the content inside the `template` will not be rendered.

As a corrective measure, this mod will therefore remove any `template` elements without valid directives.

## Contributing

Install dependencies:

```sh
yarn
```

Run tests:

```sh
yarn test
```

Run the linter:

```sh
yarn lint
```
